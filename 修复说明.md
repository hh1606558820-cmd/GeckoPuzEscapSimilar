# 修复说明 - 直接双击打开空白问题

## 问题原因

之前的构建使用了 ES 模块（`type="module"`），在 file:// 协议下可能遇到 CORS 限制，导致浏览器显示空白。

## 修复方案

### 1. 修改构建格式

在 `vite.config.ts` 中配置使用 IIFE 格式：

```typescript
build: {
  rollupOptions: {
    output: {
      format: 'iife',  // 使用 IIFE 格式，避免 ES 模块问题
      inlineDynamicImports: true,  // 内联所有代码到一个文件
    },
  },
}
```

### 2. 移除 type="module" 属性

创建了 `fix-html.js` 后处理脚本，在构建后自动移除 HTML 中的 `type="module"` 属性。

### 3. CSS 内联

CSS 样式已内联到 JS 文件中，通过 `<style>` 标签动态注入，减少文件数量。

## 修复结果

✅ **现在可以直接双击 `index.html` 打开，无需服务器！**

### 构建后的文件结构

```
dist/
├── index.html          # 主页面（已修复，无 type="module"）
├── assets/
│   └── index.js       # IIFE 格式的 JS 文件（包含内联 CSS）
├── start.bat          # 备用启动脚本
├── start.sh           # 备用启动脚本
└── 使用说明.txt       # 使用说明
```

### HTML 文件内容

修复后的 `index.html`：

```html
<script src="./assets/index.js"></script>
```

不再是：
```html
<script type="module" crossorigin src="./assets/index.js"></script>
```

## 使用方法

1. **直接双击打开**（推荐）：
   - 双击 `dist/index.html` 文件
   - 浏览器会自动打开关卡编辑器

2. **备用方法**（如果直接打开不行）：
   - 双击 `start.bat` 启动本地服务器
   - 在浏览器中打开 `http://localhost:3000`

## 技术细节

- **IIFE 格式**：立即执行函数表达式，不依赖 ES 模块系统
- **相对路径**：所有资源使用 `./` 相对路径
- **内联 CSS**：CSS 通过 JavaScript 动态注入，避免额外的文件加载
- **单文件输出**：所有代码打包到一个 JS 文件，避免动态导入问题

## 浏览器支持

支持所有现代浏览器：
- Chrome 111+
- Firefox 114+
- Edge 111+
- Safari 16.4+

## 验证方法

1. 运行 `npm run build`
2. 检查 `dist/index.html`，确认没有 `type="module"`
3. 双击 `dist/index.html` 文件
4. 应该能正常显示关卡编辑器界面

---

**修复完成！现在可以直接双击打开使用了！** 🎉
